"use strict";angular.module("angular-tabs",["angular-tabs-utils"]).provider("$uiTabs",function(){function e(e,a){var r=n[e];return r?angular.extend(new t,r,a||{}):void 0}var t=function(){this.$dirty=!1,this.$selected=!1,this.$volatile=!0,this.$data={}};t.prototype.onClose=["$q",function(e){return function(){var t=e.defer();return t.resolve(),t.promise}}];var n={"null":{template:""}};this.tab=function(e,t){return n[e]=angular.extend({},t),this},this.welcome=function(e){return this.tab(null,e)},this.config=function(e){t.prototype.tabHeaderItemTemplateUrl=e.tabHeaderItemTemplateUrl||"src/templates/templateItemUrl.html",t.prototype.tabHeaderMenuItemTemplateUrl=e.tabHeaderMenuItemTemplateUrl||"src/templates/templateMenuItemUrl.html"},this.onClose=function(e){t.prototype.onClose=e},this.$get=["$rootScope","$injector","$sce","$http","$q","$templateCache","utils",function(t,n,a,r,i,o,l){function u(e){return i.when(e).then(function(){t.$broadcast("$tabLoadStart",e);var l,u,s=angular.extend({},e.resolve);return angular.forEach(s,function(e,t){s[t]=angular.isString(e)?n.get(e):n.invoke(e)}),angular.isDefined(l=e.template)?angular.isFunction(l)&&(l=l(e.params)):angular.isDefined(u=e.templateUrl)&&(angular.isFunction(u)&&(u=u(e.params)),u=a.getTrustedResourceUrl(u),angular.isDefined(u)&&(e.loadedTemplateUrl=u,l=r.get(u,{cache:o}).then(function(e){return e.data}))),angular.isDefined(l)&&(s.$template=l),i.all(s)}).then(function(n){return e.locals=n,t.$broadcast("$tabLoadEnd",e),e})}function s(e){var n=d(e),a=b();return n&&a&&n.$$tabId===a.$$tabId?t.$broadcast("$tabUpdate",a):n?(t.$broadcast("$tabChangeStart",n,a),a&&(a.$selected=!1),n.$selected=!0,l.remove(c.history,function(t){return e===t}),c.history.push(e),t.$broadcast("$tabChangeSuccess",n,a)):t.$broadcast("$tabChangeError",n,"Cloud not found tab with id #"+e),n}var c={arr:[],map:{},history:[]},d=function(e){return c.map[e]},p=function(e){var t=d(e);i.when(t).then(function(){if(t.onClose){var e=angular.isString(t.onClose)?n.get(t.onClose):n.invoke(t.onClose);return e(t)}}).then(function(){$(t)})},$=function(e){l.remove(c.history,function(t){return t===e.$$tabId}),e.$selected&&c.history.length>0&&s(c.history[c.history.length-1]),h(e),c.arr.splice(c.arr.indexOf(e),1),delete c.map[e.$$tabId],t.$broadcast("$tabRemoveSuccess",e)},b=function(){var e=l.filter(c.map,function(e){return e.$selected});if(1===e.length)return e[0];if(0===e.length)return void 0;if(e.length>1)throw new Error("There should not be more than one selected tab at a time.")},f=function(){return c.arr},h=function(e){e.scope&&(e.scope.$destroy(),e.scope=null)},m=function(n,a,r){var i=e(n,a);if(!i)throw new Error("Unknown tab type: "+n);return i.$$tabId=r||Math.random().toString(16).substr(2),u(i).then(function(e){var t=d(e.$$tabId);return t?(h(t),angular.copy(e,t)):(null!==n&&c.arr.push(e),c.map[e.$$tabId]=e),s(e.$$tabId)},function(e){t.$broadcast("$tabAddError",i,e)})};return m(null),{addTab:m,getTabs:f,getTab:d,removeTab:p,selectTab:s,getActiveTab:b}}]}).directive("tabView",["$uiTabs","$anchorScroll","$animate",function(e,t,n){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(a,r,i,o,l){function u(e,t){if(t.$selected===!1){var n=h[t.$$tabId];n&&(delete h[t.$$tabId],n.remove(),n=null)}}function s(){var t=p&&p.data("$$tabId"),a=e.getTab(t);$&&($.remove(),$=null),d&&void 0===a&&(d.$destroy(),d=null),p&&(a?(n.addClass(p,"ng-hide"),$=null):(n.leave(p,function(){$=null}),$=p,p=null))}function c(e,i){var o=h[i.$$tabId];if(o)return n.removeClass(o,"ng-hide"),s(),void(p=o);var u=i&&i.locals,c=u&&u.$template;if(angular.isDefined(c)){var $=a.$new();$.$$tabId=i.$$tabId,i.$volatile!==!1&&($.$data=i.$data),$.$setTabDirty=function(){i.$dirty=!0};var m=l($,function(e){n.enter(e,null,p||r,function(){!angular.isDefined(b)||b&&!a.$eval(b)||t()}),s()});p=m,d=$,i.$volatile===!1&&(p.data("$$tabId",i.$$tabId),h[i.$$tabId]=p,i.scope=$),$.$emit("$tabContentLoaded"),$.$eval(f)}else s()}var d,p,$,b=i.autoscroll,f=i.onload||"",h={};a.$on("$tabChangeSuccess",c),a.$on("$tabRemoveSuccess",u)}}}]).directive("tabView",["$compile","$controller","$uiTabs",function(e,t,n){return{restrict:"ECA",priority:-400,link:function(a,r){var i=n.getActiveTab(),o=i.locals;r.html(o.$template),r.addClass("xl-tab-system-view");var l=e(r.contents());if(i.controller){o.$scope=a;var u=t(i.controller,o);i.controllerAs&&(a[i.controllerAs]=u),r.data("$ngControllerController",u),r.children().data("$ngControllerController",u)}a.$$currentTabId=i.$$tabId,l(a)},controller:["$scope",function(e){this.$$getCurrentTabId=function(){return e.$$currentTabId}}]}}]).directive("closeUiTab",["$uiTabs",function(e){return{restrict:"ECA",priority:-400,require:"^tabView",link:function(t,n,a,r){n.on("click",function(){t.$apply(function(){e.removeTab(r.$$getCurrentTabId())})})}}}]).directive("closeUiTabHeader",["$uiTabs",function(e){return{restrict:"ECA",priority:-401,link:function(t,n){n.on("click",function(){t.$apply(function(){e.removeTab(t.tab.$$tabId)})})}}}]).directive("tabHeaderItem",["$http","$templateCache","$compile","$parse",function(e,t,n){return{restrict:"EA",scope:{index:"=",tab:"="},priority:-402,link:function(a,r,i){var o="menu"===i.type?a.tab.tabHeaderMenuItemTemplateUrl:a.tab.tabHeaderItemTemplateUrl;e.get(o,{cache:t}).success(function(e){r.replaceWith(n(e.trim())(a))})}}}]).directive("tabHeader",["$uiTabs","$window","$timeout","utils",function(e,t,n,a){return{restrict:"ECA",priority:-400,template:'<div class="xl-components ui-tab-header" ui-tab-menu-dropdown>\n    <div class="ui-tab-header-wrapper">\n        <ul class="ui-tab-header-container">\n            <li class="ui-tab-header-item" ng-class="{active: tab.$selected}" data-ng-repeat="tab in tabs" data-ng-click="selectTab(tab, $index)">\n                <span tab-header-item type="tab" tab="tab" index="$index"></span>\n            </li>\n        </ul>\n    </div>\n\n    <span class="ui-tab-header-menu-toggle" ui-tab-menu-dropdown-toggle ng-show="showTabMenuHandler"></span>\n    <div class="ui-tab-header-menu">\n        <ul>\n            <li class="ui-tab-header-menu-item" data-ng-repeat="tab in tabs" data-ng-click="selectTab(tab, $index)">\n                <span tab-header-item type="menu" tab="tab" index="$index"></span>\n            </li>\n        </ul>\n    </div>\n</div>\n',scope:{},controller:function(){},link:function(r,i){var o,l=i.find("ul.ui-tab-header-container"),u=i.find("div.ui-tab-header-wrapper");r.tabs=e.getTabs(),r.selectTab=function(t,n){e.selectTab(t.$$tabId),s(n)},r.closeTab=function(t){e.removeTab(t.$$tabId)},r.$watchCollection("tabs",function(t){n(function(){var n=t.indexOf(e.getActiveTab());-1!==n&&s(n)})});var s=function(e){var t;if(l.outerWidth()+l.position().left<u.innerWidth()&&(t=Math.min(u.innerWidth()-l.outerWidth(),0)),r.showTabMenuHandler=u.innerWidth()<l.outerWidth(),void 0!==e){var n=i.find("li.ui-tab-header-item:nth-child("+(e+1)+")"),a=l.position().left;if(a+n.position().left<0)t=-n.position().left;else{var s=n.position().left+n.outerWidth()+a;s>u.innerWidth()&&(t=u.innerWidth()+a-s)}}void 0!==t&&l.css({left:t}),o=e},c=angular.element(t);c.bind("resize",a.debounce(function(){r.$apply(s(o))},200))}}}]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document",function(e){var t=null;this.open=function(r){t||(e.bind("click",n),e.bind("keydown",a)),t&&t!==r&&(t.isOpen=!1),t=r},this.close=function(r){t===r&&(t=null,e.unbind("click",n),e.unbind("keydown",a))};var n=function(e){if(t){var n=t.getToggleElement();e&&n&&n[0].contains(e.target)||t.$apply(function(){t.isOpen=!1})}},a=function(e){27===e.which&&(t.focusToggleElement(),n())}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate",function(e,t,n,a,r,i){var o,l=this,u=e.$new(),s=a.openClass,c=angular.noop,d=t.onToggle?n(t.onToggle):angular.noop;this.init=function(a){l.$element=a,t.isOpen&&(o=n(t.isOpen),c=o.assign,e.$watch(o,function(e){u.isOpen=!!e}))},this.toggle=function(e){return u.isOpen=arguments.length?!!e:!u.isOpen,u.isOpen},this.isOpen=function(){return u.isOpen},u.getToggleElement=function(){return l.toggleElement},u.focusToggleElement=function(){l.toggleElement&&l.toggleElement[0].focus()},u.$watch("isOpen",function(t,n){i[t?"addClass":"removeClass"](l.$element,s),t?(u.focusToggleElement(),r.open(u)):r.close(u),c(e,t),angular.isDefined(t)&&t!==n&&d(e,{open:!!t})}),e.$on("$locationChangeSuccess",function(){u.isOpen=!1}),e.$on("$destroy",function(){u.$destroy()})}]).directive("uiTabMenuDropdown",function(){return{controller:"DropdownController",link:function(e,t,n,a){a.init(t)}}}).directive("uiTabMenuDropdownToggle",function(){return{require:"?^uiTabMenuDropdown",priority:-500,link:function(e,t,n,a){if(a){a.toggleElement=t;var r=function(r){r.preventDefault(),t.hasClass("disabled")||n.disabled||e.$apply(function(){a.toggle()})};t.bind("click",r),t.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(a.isOpen,function(e){t.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){t.unbind("click",r)})}}}}).run(["$templateCache",function(e){e.put("src/templates/templateItemUrl.html",'<span class="asterisk" ng-show="tab.$dirty">*</span><span class="ui-tab-header-title">{{tab.title}}</span><span class="ui-tab-header-close" close-ui-tab-header></span>'),e.put("src/templates/templateMenuItemUrl.html",'<span class="ui-tab-header-menu-item-title">{{tab.title}}</span>')}]),angular.module("angular-tabs-utils",[]).service("utils",function(){return{remove:function(e,t){for(var n=-1,a=e?e.length:0,r=[];++n<a;){var i=e[n];t(i,n,e)&&(r.push(i),[].splice.call(e,n--,1),a--)}return r},filter:function(e,t){var n=[];return angular.forEach(e,function(e,a,r){t(e,a,r)&&n.push(e)}),n},debounce:function(e,t,n){function a(){l=null,n||(i=e.apply(o,r))}var r,i,o,l;return function(){var u=n&&!l;return r=arguments,o=this,clearTimeout(l),l=setTimeout(a,t),u&&(i=e.apply(o,r)),i}}}});