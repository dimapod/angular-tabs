"use strict";angular.module("angular-tabs",["angular-tabs-utils"]).provider("$uiTabs",function(){function e(e,a){var i=n[e];return i?angular.extend(new t,i,a||{}):void 0}var t=function(){this.$dirty=!1,this.$selected=!1,this.$volatile=!0,this.$data={}};t.prototype.onClose=["$q",function(e){return function(){var t=e.defer();return t.resolve(),t.promise}}];var n={"null":{template:""}};this.tab=function(e,t){return n[e]=angular.extend({},t),this},this.welcome=function(e){return this.tab(null,e)},this.config=function(e){t.prototype.tabHeaderItemTemplateUrl=e.tabHeaderItemTemplateUrl||"src/templates/templateItemUrl.html",t.prototype.tabHeaderMenuItemTemplateUrl=e.tabHeaderMenuItemTemplateUrl||"src/templates/templateMenuItemUrl.html"},this.onClose=function(e){t.prototype.onClose=e},this.$get=["$rootScope","$injector","$sce","$http","$q","$templateCache","utils",function(t,n,a,i,r,o,l){function u(e){return r.when(e).then(function(){t.$broadcast("$tabLoadStart",e);var l,u,s=angular.extend({},e.resolve);return angular.forEach(s,function(e,t){s[t]=angular.isString(e)?n.get(e):n.invoke(e)}),angular.isDefined(l=e.template)?angular.isFunction(l)&&(l=l(e.params)):angular.isDefined(u=e.templateUrl)&&(angular.isFunction(u)&&(u=u(e.params)),u=a.getTrustedResourceUrl(u),angular.isDefined(u)&&(e.loadedTemplateUrl=u,l=i.get(u,{cache:o}).then(function(e){return e.data}))),angular.isDefined(l)&&(s.$template=l),r.all(s)}).then(function(n){return e.locals=n,t.$broadcast("$tabLoadEnd",e),e})}function s(e){var n=d(e),a=b();return n&&a&&n.$$tabId===a.$$tabId?t.$broadcast("$tabUpdate",a):n?(t.$broadcast("$tabChangeStart",n,a),a&&(a.$selected=!1),n.$selected=!0,c.activeTab=n,l.remove(c.history,function(t){return e===t}),c.history.push(e),t.$broadcast("$tabChangeSuccess",n,a)):t.$broadcast("$tabChangeError",n,"Cloud not found tab with id #"+e),n}var c={arr:[],map:{},history:[],activeTab:void 0},d=function(e){return c.map[e]},p=function(e){var t=d(e);r.when(t).then(function(){if(t.onClose){var e=angular.isString(t.onClose)?n.get(t.onClose):n.invoke(t.onClose);return e(t)}}).then(function(){$(t)})},$=function(e){l.remove(c.history,function(t){return t===e.$$tabId}),e.$selected&&c.history.length>0&&s(c.history[c.history.length-1]),h(e),c.arr.splice(c.arr.indexOf(e),1),delete c.map[e.$$tabId],t.$broadcast("$tabRemoveSuccess",e)},b=function(){return c.activeTab},f=function(){return c.arr},h=function(e){e.scope&&(e.scope.$destroy(),e.scope=null)},m=function(n,a,i){var r=e(n,a);if(!r)throw new Error("Unknown tab type: "+n);return r.$$tabId=i||Math.random().toString(16).substr(2),r.close=function(){p(this.$$tabId)},u(r).then(function(e){var t=d(e.$$tabId);return t?(h(t),angular.copy(e,t)):(null!==n&&c.arr.push(e),c.map[e.$$tabId]=e),s(e.$$tabId)},function(e){t.$broadcast("$tabAddError",r,e)})};return m(null),{addTab:m,getTabs:f,getTab:d,removeTab:p,selectTab:s,getActiveTab:b}}]}).directive("tabView",["$uiTabs","$anchorScroll","$animate",function(e,t,n){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(a,i,r,o,l){function u(e,t){if(t.$selected===!1){var n=h[t.$$tabId];n&&(delete h[t.$$tabId],n.remove(),n=null)}}function s(){var t=p&&p.data("$$tabId"),a=e.getTab(t);$&&($.remove(),$=null),d&&void 0===a&&(d.$destroy(),d=null),p&&(a?(n.addClass(p,"ng-hide"),$=null):(n.leave(p,function(){$=null}),$=p,p=null))}function c(e,r){var o=h[r.$$tabId];if(o)return n.removeClass(o,"ng-hide"),s(),void(p=o);var u=r&&r.locals,c=u&&u.$template;if(angular.isDefined(c)){var $=a.$new();$.$$tabId=r.$$tabId,r.$volatile!==!1&&($.$data=r.$data),$.$setTabDirty=function(){r.$dirty=!0};var m=l($,function(e){n.enter(e,null,p||i,function(){!angular.isDefined(b)||b&&!a.$eval(b)||t()}),s()});p=m,d=$,r.$volatile===!1&&(p.data("$$tabId",r.$$tabId),h[r.$$tabId]=p,r.scope=$),$.$emit("$tabContentLoaded"),$.$eval(f)}else s()}var d,p,$,b=r.autoscroll,f=r.onload||"",h={};a.$on("$tabChangeSuccess",c),a.$on("$tabRemoveSuccess",u)}}}]).directive("tabView",["$compile","$controller","$uiTabs",function(e,t,n){return{restrict:"ECA",priority:-400,link:function(a,i){var r=n.getActiveTab(),o=r.locals;i.html(o.$template),i.addClass("ui-tab-system-view");var l=e(i.contents());if(r.controller){o.$scope=a;var u=t(r.controller,o);r.controllerAs&&(a[r.controllerAs]=u),i.data("$ngControllerController",u),i.children().data("$ngControllerController",u)}a.$$currentTab=r,l(a)},controller:["$scope",function(e){this.$$getCurrentTab=function(){return e.$$currentTab}}]}}]).directive("closeUiTab",["$uiTabs",function(){return{restrict:"ECA",priority:-400,require:"^tabView",link:function(e,t,n,a){t.on("click",function(){e.$apply(function(){a.$$getCurrentTab().close()})})}}}]).directive("closeUiTabHeader",["$uiTabs",function(){return{restrict:"ECA",priority:-401,link:function(e,t){t.on("click",function(){e.$apply(function(){e.tab.close()})})}}}]).directive("tabHeaderItem",["$http","$templateCache","$compile","$parse",function(e,t,n){return{restrict:"EA",scope:{index:"=",tab:"="},priority:-402,link:function(a,i,r){var o="menu"===r.type?a.tab.tabHeaderMenuItemTemplateUrl:a.tab.tabHeaderItemTemplateUrl;e.get(o,{cache:t}).success(function(e){i.replaceWith(n(e.trim())(a))})}}}]).directive("tabHeader",["$uiTabs","$window","$timeout","utils",function(e,t,n,a){return{restrict:"ECA",priority:-400,template:'<div class="ui-tab-header" ui-tab-menu-dropdown>\n    <div class="ui-tab-header-wrapper">\n        <ul class="ui-tab-header-container">\n            <li class="ui-tab-header-item" ng-class="{active: tab.$selected}" data-ng-repeat="tab in tabs" data-ng-click="selectTab(tab, $index)">\n                <span tab-header-item type="tab" tab="tab" index="$index"></span>\n            </li>\n        </ul>\n    </div>\n\n    <span class="ui-tab-header-menu-toggle" ui-tab-menu-dropdown-toggle ng-show="showTabMenuHandler"></span>\n    <div class="ui-tab-header-menu">\n        <ul>\n            <li class="ui-tab-header-menu-item" data-ng-repeat="tab in tabs" data-ng-click="selectTab(tab, $index)">\n                <span tab-header-item type="menu" tab="tab" index="$index"></span>\n            </li>\n        </ul>\n    </div>\n</div>\n',scope:{},controller:function(){},link:function(i,r){var o,l=r.find("ul.ui-tab-header-container"),u=r.find("div.ui-tab-header-wrapper");i.tabs=e.getTabs(),i.selectTab=function(t,n){e.selectTab(t.$$tabId),s(n)},i.closeTab=function(t){e.removeTab(t.$$tabId)},i.$watchCollection("tabs",function(t){n(function(){var n=t.indexOf(e.getActiveTab());-1!==n&&s(n)})});var s=function(e){var t;if(l.outerWidth()+l.position().left<u.innerWidth()&&(t=Math.min(u.innerWidth()-l.outerWidth(),0)),i.showTabMenuHandler=u.innerWidth()<l.outerWidth(),void 0!==e){var n=r.find("li.ui-tab-header-item:nth-child("+(e+1)+")"),a=l.position().left;if(a+n.position().left<0)t=-n.position().left;else{var s=n.position().left+n.outerWidth()+a;s>u.innerWidth()&&(t=u.innerWidth()+a-s)}}void 0!==t&&l.css({left:t}),o=e},c=angular.element(t);c.bind("resize",a.debounce(function(){i.$apply(s(o))},200))}}}]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document",function(e){var t=null;this.open=function(i){t||(e.bind("click",n),e.bind("keydown",a)),t&&t!==i&&(t.isOpen=!1),t=i},this.close=function(i){t===i&&(t=null,e.unbind("click",n),e.unbind("keydown",a))};var n=function(e){if(t){var n=t.getToggleElement();e&&n&&n[0].contains(e.target)||t.$apply(function(){t.isOpen=!1})}},a=function(e){27===e.which&&(t.focusToggleElement(),n())}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate",function(e,t,n,a,i,r){var o,l=this,u=e.$new(),s=a.openClass,c=angular.noop,d=t.onToggle?n(t.onToggle):angular.noop;this.init=function(a){l.$element=a,t.isOpen&&(o=n(t.isOpen),c=o.assign,e.$watch(o,function(e){u.isOpen=!!e}))},this.toggle=function(e){return u.isOpen=arguments.length?!!e:!u.isOpen,u.isOpen},this.isOpen=function(){return u.isOpen},u.getToggleElement=function(){return l.toggleElement},u.focusToggleElement=function(){l.toggleElement&&l.toggleElement[0].focus()},u.$watch("isOpen",function(t,n){r[t?"addClass":"removeClass"](l.$element,s),t?(u.focusToggleElement(),i.open(u)):i.close(u),c(e,t),angular.isDefined(t)&&t!==n&&d(e,{open:!!t})}),e.$on("$locationChangeSuccess",function(){u.isOpen=!1}),e.$on("$destroy",function(){u.$destroy()})}]).directive("uiTabMenuDropdown",function(){return{controller:"DropdownController",link:function(e,t,n,a){a.init(t)}}}).directive("uiTabMenuDropdownToggle",function(){return{require:"?^uiTabMenuDropdown",priority:-500,link:function(e,t,n,a){if(a){a.toggleElement=t;var i=function(i){i.preventDefault(),t.hasClass("disabled")||n.disabled||e.$apply(function(){a.toggle()})};t.bind("click",i),t.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(a.isOpen,function(e){t.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){t.unbind("click",i)})}}}}).run(["$templateCache",function(e){e.put("src/templates/templateItemUrl.html",'<span class="asterisk" ng-show="tab.$dirty">*</span><span class="ui-tab-header-title">{{tab.title}}</span><span class="ui-tab-header-close" close-ui-tab-header></span>'),e.put("src/templates/templateMenuItemUrl.html",'<span class="ui-tab-header-menu-item-title">{{tab.title}}</span>')}]),angular.module("angular-tabs-utils",[]).service("utils",function(){return{remove:function(e,t){for(var n=-1,a=e?e.length:0,i=[];++n<a;){var r=e[n];t(r,n,e)&&(i.push(r),[].splice.call(e,n--,1),a--)}return i},debounce:function(e,t,n){function a(){l=null,n||(r=e.apply(o,i))}var i,r,o,l;return function(){var u=n&&!l;return i=arguments,o=this,clearTimeout(l),l=setTimeout(a,t),u&&(r=e.apply(o,i)),r}}}});